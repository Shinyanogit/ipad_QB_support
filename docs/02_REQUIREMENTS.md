# Requirements

## 必須（MVP）
- QB演習ページ（`/Answer/...`）で動作する注入UI
- 問題情報の抽出
  - 問題ID
  - 進捗（例: `演習中 60 / 95 問目`）
  - 選択肢数
  - 掲載頁
  - 問題タグ（first/compulsory など）
  - 添付画像（最大4MB/枚、data URL化）
- SPA遷移やDOM更新に追従
- 設定保存（`storage`）
  - ショートカット有効/無効
  - ナビ（前/次）、解答、選択肢キーの割り当て
  - ノート/検索バーの表示/非表示
  - ChatGPTバーの開閉/位置/APIキー/モデル
  - テーマ（ライト/ダーク/システム）とページ色差し込み

## ChatGPTバー要件
- 右側ドックで開閉でき、ドラッグで左右切替・幅調整が可能
- APIキーはユーザーが設定（保存済み表示）
- モデル選択（`gpt-5.2` / `gpt-5.2-chat-latest` / `gpt-5` / `gpt-4.1` / `gpt-4o`）
- 問題文＋選択肢＋画像を自動で取り込み、質問に回答
- ストリーミング表示・Markdown表示・コピー・トークン/概算費用表示
- 会話履歴を保持しつつ、`Ctrl+N` で新規会話にリセット
- ユーザー入力が400語超の場合は折りたたみ表示（クリックで開閉）

## キーボード操作（PC向け）
- `ArrowRight`/`ArrowLeft` で次/前の問題へ移動
- `a`〜`e` で選択肢(0-4)をトグル（設定で変更可）
- 「解答を確認する」キーは設定で変更可（初期値は `Ctrl+S`）
- `Ctrl+O` でチャットドック開閉
- `Ctrl+S` で設定パネル開閉（解答キーと競合するため変更推奨）
- `Ctrl+N` で会話リセット
- 修飾キー付きショートカットは入力中でも有効（IME変換中は除外）

## iPad向けUI要件
- キーボード依存を避け、タップ操作のUIを用意
- iframe/SPAでDOMが変わっても再注入される

## 重要方針
- 参照HTMLのDOM構造に基づく安定セレクタとフォールバックを併用
- 中核ロジックは純粋TSとして切り出す
- UI/拡張API依存は最小化する

## 非目標（現時点）
- 問題文/解説の全文保存
- 外部API連携の自動同期（バックエンド経由は検討中）
- 学習履歴の永続ログ
